<!-- music/templates/music/_music_genres_modal.html -->
{% load widget_tweaks %}

<div class="space-y-6">
  <div>
    <h2 class="text-lg font-semibold">Edit Genres</h2>
    <p class="text-sm opacity-70">{{ music.title }}</p>
  </div>

  <form
    method="post"
    hx-post="{% url 'music:music_genres_assign' music.pk %}"
    hx-target="#music-genres-modal-body"
    hx-swap="innerHTML"
    hx-on::after-request="if (event.detail.successful && event.detail.requestConfig.verb === 'post') document.getElementById('music-genres-modal').close()"
  >
    {% csrf_token %}
    {{ form.non_field_errors }}

    <div id="music-genres-form" class="grid gap-2">
      {{ form.genres.errors }}
      {{ form.genres }}
    </div>

    <div class="mt-4 flex flex-wrap gap-2">
      <button type="submit" class="btn btn-primary btn-sm">Save genres</button>
      {% if is_modal %}
        <button type="button" class="btn btn-ghost btn-sm" onclick="document.getElementById('music-genres-modal').close()">Cancel</button>
      {% else %}
        <a class="btn btn-ghost btn-sm" href="{% url 'music:music_edit' music.pk %}">Cancel</a>
      {% endif %}
    </div>
  </form>

  <div class="divider">Quick add genre</div>

  <form
    method="post"
    hx-post="{% url 'music:music_genre_quick_add_hx' music.pk %}"
    hx-target="#music-genres-modal-body"
    hx-swap="innerHTML"
  >
    {% csrf_token %}
    <div class="form-control w-full">
      <label class="label"><span class="label-text">Genre name</span></label>
      {% render_field genre_quick_form.name class="input input-bordered w-full" %}
      {% if genre_quick_form.name.errors %}
        <label class="label"><span class="label-text-alt text-error">{{ genre_quick_form.name.errors.0 }}</span></label>
      {% endif %}
    </div>
    <div class="mt-3 flex justify-end">
      <button type="submit" class="btn btn-outline btn-sm">Add genre</button>
    </div>
  </form>
</div>
