<!-- music/templates/music/_music_list_table.html -->

{% if music_list %}
  <input type="hidden" id="music-sort-input" name="sort" value="{{ sort }}" hx-swap-oob="true">
  <input type="hidden" id="music-dir-input" name="dir" value="{{ sort_dir }}" hx-swap-oob="true">
  <div class="overflow-x-auto border border-base-200 rounded-lg bg-base-100">
    <table class="table table-sm sm:table-md">
      <thead>
        <tr>
          <th>
            <a
              class="flex items-center gap-1"
              href="?{{ sort_query_prefix }}sort=location&dir={{ sort_state.location.next_dir }}"
              hx-get="?{{ sort_query_prefix }}sort=location&dir={{ sort_state.location.next_dir }}"
              hx-target="#music-table-container"
              hx-push-url="true"
            >
              Location
              {% if sort_state.location.active %}
                {% if sort_dir == "asc" %}
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m6 15 6-6 6 6" />
                  </svg>
                {% else %}
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m18 9-6 6-6-6" />
                  </svg>
                {% endif %}
              {% else %}
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 opacity-60" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m6 9 6-6 6 6M6 15l6 6 6-6" />
                </svg>
              {% endif %}
            </a>
          </th>
          <th>
            <a
              class="flex items-center gap-1"
              href="?{{ sort_query_prefix }}sort=title&dir={{ sort_state.title.next_dir }}"
              hx-get="?{{ sort_query_prefix }}sort=title&dir={{ sort_state.title.next_dir }}"
              hx-target="#music-table-container"
              hx-push-url="true"
            >
              Title
              {% if sort_state.title.active %}
                {% if sort_dir == "asc" %}
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m6 15 6-6 6 6" />
                  </svg>
                {% else %}
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m18 9-6 6-6-6" />
                  </svg>
                {% endif %}
              {% else %}
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 opacity-60" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m6 9 6-6 6 6M6 15l6 6 6-6" />
                </svg>
              {% endif %}
            </a>
          </th>
          <th>
            <a
              class="flex items-center gap-1"
              href="?{{ sort_query_prefix }}sort=composers&dir={{ sort_state.composers.next_dir }}"
              hx-get="?{{ sort_query_prefix }}sort=composers&dir={{ sort_state.composers.next_dir }}"
              hx-target="#music-table-container"
              hx-push-url="true"
            >
              Composers
              {% if sort_state.composers.active %}
                {% if sort_dir == "asc" %}
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m6 15 6-6 6 6" />
                  </svg>
                {% else %}
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m18 9-6 6-6-6" />
                  </svg>
                {% endif %}
              {% else %}
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 opacity-60" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m6 9 6-6 6 6M6 15l6 6 6-6" />
                </svg>
              {% endif %}
            </a>
          </th>
          <th>
            <a
              class="flex items-center gap-1"
              href="?{{ sort_query_prefix }}sort=arrangers&dir={{ sort_state.arrangers.next_dir }}"
              hx-get="?{{ sort_query_prefix }}sort=arrangers&dir={{ sort_state.arrangers.next_dir }}"
              hx-target="#music-table-container"
              hx-push-url="true"
            >
              Arrangers
              {% if sort_state.arrangers.active %}
                {% if sort_dir == "asc" %}
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m6 15 6-6 6 6" />
                  </svg>
                {% else %}
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m18 9-6 6-6-6" />
                  </svg>
                {% endif %}
              {% else %}
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 opacity-60" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m6 9 6-6 6 6M6 15l6 6 6-6" />
                </svg>
              {% endif %}
            </a>
          </th>
          <th>
            <a
              class="flex items-center gap-1"
              href="?{{ sort_query_prefix }}sort=duration&dir={{ sort_state.duration.next_dir }}"
              hx-get="?{{ sort_query_prefix }}sort=duration&dir={{ sort_state.duration.next_dir }}"
              hx-target="#music-table-container"
              hx-push-url="true"
            >
              Duration
              {% if sort_state.duration.active %}
                {% if sort_dir == "asc" %}
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m6 15 6-6 6 6" />
                  </svg>
                {% else %}
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m18 9-6 6-6-6" />
                  </svg>
                {% endif %}
              {% else %}
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 opacity-60" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m6 9 6-6 6 6M6 15l6 6 6-6" />
                </svg>
              {% endif %}
            </a>
          </th>
          {% if view_mode == "full" %}
            <th>
              <a
                class="flex items-center gap-1"
                href="?{{ sort_query_prefix }}sort=genres&dir={{ sort_state.genres.next_dir }}"
                hx-get="?{{ sort_query_prefix }}sort=genres&dir={{ sort_state.genres.next_dir }}"
                hx-target="#music-table-container"
                hx-push-url="true"
              >
                Genres
                {% if sort_state.genres.active %}
                  {% if sort_dir == "asc" %}
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m6 15 6-6 6 6" />
                    </svg>
                  {% else %}
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m18 9-6 6-6-6" />
                    </svg>
                  {% endif %}
                {% else %}
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 opacity-60" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m6 9 6-6 6 6M6 15l6 6 6-6" />
                  </svg>
                {% endif %}
              </a>
            </th>
            <th>
              <a
                class="flex items-center gap-1"
                href="?{{ sort_query_prefix }}sort=status&dir={{ sort_state.status.next_dir }}"
                hx-get="?{{ sort_query_prefix }}sort=status&dir={{ sort_state.status.next_dir }}"
                hx-target="#music-table-container"
                hx-push-url="true"
              >
                Status
                {% if sort_state.status.active %}
                  {% if sort_dir == "asc" %}
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m6 15 6-6 6 6" />
                    </svg>
                  {% else %}
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m18 9-6 6-6-6" />
                    </svg>
                  {% endif %}
                {% else %}
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 opacity-60" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m6 9 6-6 6 6M6 15l6 6 6-6" />
                  </svg>
                {% endif %}
              </a>
            </th>
            <th>
              <a
                class="flex items-center gap-1"
                href="?{{ sort_query_prefix }}sort=flags&dir={{ sort_state.flags.next_dir }}"
                hx-get="?{{ sort_query_prefix }}sort=flags&dir={{ sort_state.flags.next_dir }}"
                hx-target="#music-table-container"
                hx-push-url="true"
              >
                Flags
                {% if sort_state.flags.active %}
                  {% if sort_dir == "asc" %}
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m6 15 6-6 6 6" />
                    </svg>
                  {% else %}
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-primary" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m18 9-6 6-6-6" />
                    </svg>
                  {% endif %}
                {% else %}
                  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 opacity-60" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m6 9 6-6 6 6M6 15l6 6 6-6" />
                  </svg>
                {% endif %}
              </a>
            </th>
          {% endif %}
        </tr>
      </thead>
      <tbody>
        {% for music in music_list %}
          <tr>
            <td class="whitespace-nowrap">
              {% if music.location_drawer %}
                {{ music.location_drawer }} - {{ music.location_number }}
              {% else %}
                --
              {% endif %}
            </td>
            <td class="max-w-xs">
              <a
                class="tooltip tooltip-top font-medium text-cyan-700 hover:text-cyan-900 hover:underline underline-offset-2 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-cyan-600"
                href="{% url 'music:music_detail' music.pk %}"
                aria-label="View details for {{ music.title }}"
                data-tip="View details"
              >
                {{ music.title }}
              </a>
            </td>
            <td class="text-sm">
              {% if music.composer_names %}
                {{ music.composer_names }}
              {% else %}
                <span class="opacity-60">-</span>
              {% endif %}
            </td>
            <td class="text-sm">
              {% if music.arranger_names %}
                {{ music.arranger_names }}
              {% else %}
                <span class="opacity-60">-</span>
              {% endif %}
            </td>
            <td class="whitespace-nowrap text-sm">
              {{ music.get_duration_display }}
            </td>
            {% if view_mode == "full" %}
              <td class="text-sm">
                {% for genre in music.genres.all %}
                  <span class="badge badge-ghost mr-1 mb-1">{{ genre.name }}</span>
                {% empty %}
                  <span class="opacity-60">--</span>
                {% endfor %}
              </td>
              <td class="text-sm">
                {% with badge=music.get_availability_badge %}
                  {% if badge %}
                    <span class="badge badge-outline">{{ badge }}</span>
                  {% else %}
                    <span class="opacity-60">-</span>
                  {% endif %}
                {% endwith %}
              </td>
              <td class="text-sm">
                <div class="flex flex-wrap gap-1">
                  {% if music.score_missing %}
                    <span class="badge badge-warning">Score missing</span>
                  {% endif %}
                  {% if music.needs_review %}
                    <span class="badge badge-info">Needs review</span>
                  {% endif %}
                  {% if not music.score_missing and not music.needs_review %}
                    <span class="opacity-60">-</span>
                  {% endif %}
                </div>
              </td>
            {% endif %}
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <div class="mt-4 flex flex-wrap items-center justify-between gap-3">
    <p class="text-sm opacity-70">Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</p>
    <div class="join">
      {% if page_obj.has_previous %}
        <a class="btn btn-xs join-item" href="?page=1&{{ list_query }}" hx-get="?page=1&{{ list_query }}">First</a>
        <a class="btn btn-xs join-item" href="?page={{ page_obj.previous_page_number }}&{{ list_query }}" hx-get="?page={{ page_obj.previous_page_number }}&{{ list_query }}">Previous</a>
      {% endif %}
      {% if page_obj.has_next %}
        <a class="btn btn-xs join-item" href="?page={{ page_obj.next_page_number }}&{{ list_query }}" hx-get="?page={{ page_obj.next_page_number }}&{{ list_query }}">Next</a>
        <a class="btn btn-xs join-item" href="?page={{ page_obj.paginator.num_pages }}&{{ list_query }}" hx-get="?page={{ page_obj.paginator.num_pages }}&{{ list_query }}">Last</a>
      {% endif %}
    </div>
  </div>
{% else %}
  <div class="rounded-lg border border-base-200 bg-base-100 p-6 text-sm opacity-70">
    No music matches your criteria.
  </div>
{% endif %}
