<!-- music/templates/music/music_roles_edit.html -->

{% extends 'base.html' %}

{% block content %}
<h1>Edit People & Roles</h1>
<p><strong>{{ music.title }}</strong></p>

<hr>

<!-- Existing assignments -->
<section>
  <h2>Current assignments</h2>

  {% if roles %}
    <ul>
      {% for role in roles %}
        <li>
          {{ role.person }} â€“ {{ role.role_type.name }}

          <form
            method="POST"
            action="{% url 'music:music_role_delete' music.id role.pk %}"
            style="display: inline"
            >
            {% csrf_token %}
            <button type="submit">Remove</button>
          </form>
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p>No people are assigned.</p>
  {% endif %}
</section>

<hr>

<!-- Add assignment -->
<section>
  <h2>Add person to role</h2>

  <form method="POST">
    {% csrf_token %}
    {{ form.non_field_errors }}

    <div>
      <label for="person-search">Person</label>

      <input
        type="text"
        id="person-search"
        name="q"
        placeholder="Search by name..."
        hx-get="{% url 'people:person_hx_search' %}"
        hx-trigger="keyup delay:300ms"
        hx-target="#person-search-results"
        hx-indicator="#person-search-loading"
        />
      <div class="live-search">
        <div id="person-search-loading" class="htmx-indicator">
         Searching...
        </div>
        <div id="person-search-results"></div>
      </div>
      <input type="hidden" name="person" id="id_person" />

      <p>
        Selected:
        <strong id="person-display">None</strong>
      </p>
    </div>

    <div>
      {{ form.role_type.label_tag }}
      {{ form.role_type }}
      {{ form.role_type.errors }}
    </div>

    <button type="submit">Add</button>
  </form>

  <p>
    Don't see the person you need?
    <a href="{% url 'people:person_add' %}?next={{ request.path }}">Add a new person</a>
  </p>

  <p>
    Need a new role type?
    <a href="{% url 'people:role_type_list' %}">Manage role types</a>
  </p>
</section>

<hr>

<nav>
  <a href="{% url 'music:music_edit' music.pk %}">
    Back to music edit
  </a>
</nav>

{% endblock %}
