<!-- organizations/templates/organizations/organization_detail.html -->
{% extends "base.html" %}

{% block title %}Organization: {{ org.name }}{% endblock %}

{% block content %}
<section class="container mx-auto px-6 py-8">
  <div class="flex flex-wrap items-center justify-between gap-3">
    <div>
      <h1 class="text-3xl font-semibold">{{ org.name }}</h1>
      <p class="text-sm opacity-70">Organization detail</p>
    </div>
    <div class="flex flex-wrap gap-2">
      {% if request.user.is_staff %}
        <a class="btn btn-primary btn-sm" href="{% url 'organizations:organization_edit' org.pk %}">Edit</a>
      {% endif %}
      <a class="btn btn-ghost btn-sm" href="{% url 'organizations:organization_list' %}">Back to list</a>
      {% if request.user.is_staff %}
        {% if org.is_active %}
          <a class="btn btn-outline btn-sm" href="{% url 'organizations:organization_deactivate' org.pk %}">Deactivate</a>
        {% else %}
          <a class="btn btn-outline btn-sm" href="{% url 'organizations:organization_activate' org.pk %}">Activate</a>
        {% endif %}
      {% endif %}
    </div>
  </div>

  <div class="grid gap-6 mt-6 lg:grid-cols-3">
    <div class="card bg-base-100 shadow-sm border border-base-200 lg:col-span-2">
      <div class="card-body">
        <h2 class="card-title">Basic Information</h2>
        <dl class="mt-3 grid gap-4 sm:grid-cols-2 text-sm">
          <div>
            <dt class="text-xs uppercase opacity-60">Status</dt>
            <dd class="mt-1">{{ org.is_active|yesno:"Active,Inactive" }}</dd>
          </div>
          <div>
            <dt class="text-xs uppercase opacity-60">Needs Review</dt>
            <dd class="mt-1">{{ org.needs_review|yesno:"Yes,No" }}</dd>
          </div>
          {% if org.contact_person %}
            <div>
              <dt class="text-xs uppercase opacity-60">Contact Person</dt>
              <dd class="mt-1">{{ org.contact_person }}</dd>
            </div>
          {% endif %}
          {% if org.contact_email %}
            <div>
              <dt class="text-xs uppercase opacity-60">Contact Email</dt>
              <dd class="mt-1">{{ org.contact_email }}</dd>
            </div>
          {% endif %}
          {% if org.contact_phone %}
            <div>
              <dt class="text-xs uppercase opacity-60">Contact Phone</dt>
              <dd class="mt-1">{{ org.contact_phone }}</dd>
            </div>
          {% endif %}
          {% if org.website %}
            <div class="sm:col-span-2">
              <dt class="text-xs uppercase opacity-60">Website</dt>
              <dd class="mt-1">
                <a class="link link-hover" href="{{ org.website }}" target="_blank" rel="noopener">{{ org.website }}</a>
              </dd>
            </div>
          {% endif %}
        </dl>
      </div>
    </div>

    <div class="card bg-base-100 shadow-sm border border-base-200">
      <div class="card-body">
        <h2 class="card-title">Statistics</h2>
        <dl class="mt-3 space-y-2 text-sm">
          <div>
            <dt class="text-xs uppercase opacity-60">Unique Music Pieces</dt>
            <dd class="mt-1">{{ stats.total_music }}</dd>
          </div>
          {% for role, count in stats.role_counts.items %}
            <div>
              <dt class="text-xs uppercase opacity-60">{{ role }} Links</dt>
              <dd class="mt-1">{{ count }}</dd>
            </div>
          {% endfor %}
        </dl>
      </div>
    </div>

    <div class="card bg-base-100 shadow-sm border border-base-200 lg:col-span-3">
      <div class="card-body">
        <h2 class="card-title">Address</h2>
        <p class="text-sm mt-2">
          {% if org.street_address %}{{ org.street_address }}<br>{% endif %}
          {% if org.city %}{{ org.city }}{% endif %}
          {% if org.state %}, {{ org.state }}{% endif %}
          {% if org.zip_code %} {{ org.zip_code }}{% endif %}
          {% if org.country %}<br>{{ org.country }}{% endif %}
          {% if not org.street_address and not org.city and not org.state and not org.zip_code and not org.country %}
            <span class="opacity-60">No address on file.</span>
          {% endif %}
        </p>
      </div>
    </div>

    <div class="card bg-base-100 shadow-sm border border-base-200 lg:col-span-3">
      <div class="card-body">
        <div class="flex items-center justify-between gap-3">
          <h2 class="card-title">Roles</h2>
          {% if request.user.is_staff %}
            <a class="btn btn-outline btn-xs" href="{% url 'organizations:organization_role_add' org.pk %}">Add role</a>
          {% endif %}
        </div>
        {% if roles %}
          <ul class="mt-3 space-y-2 text-sm">
            {% for role in roles %}
              <li class="flex flex-wrap items-center justify-between gap-2">
                <span>{{ role.role_type.name }}{% if role.notes %} <span class="opacity-60">- {{ role.notes }}</span>{% endif %}</span>
                {% if request.user.is_staff %}
                  <a class="btn btn-ghost btn-xs" href="{% url 'organizations:organization_role_deactivate' role.pk %}">Deactivate</a>
                {% endif %}
              </li>
            {% endfor %}
          </ul>
        {% else %}
          <p class="text-sm opacity-60 mt-2">No roles assigned to this organization.</p>
        {% endif %}
      </div>
    </div>

    <div class="card bg-base-100 shadow-sm border border-base-200 lg:col-span-3">
      <div class="card-body">
        <h2 class="card-title">Linked Music</h2>
        {% if music_links %}
          <div class="mt-3 overflow-x-auto border border-base-200 rounded-lg bg-base-100">
            <table class="table table-sm">
              <thead>
                <tr>
                  <th>Music Title</th>
                  <th>Role</th>
                  <th>Notes</th>
                </tr>
              </thead>
              <tbody>
                {% for link in music_links %}
                  <tr>
                    <td>
                      <a class="link link-hover" href="{% url 'music:music_detail' link.music.pk %}">
                        {{ link.music.title }}
                      </a>
                    </td>
                    <td>{{ link.role_type.name }}</td>
                    <td>{{ link.notes|default:"--" }}</td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        {% else %}
          <p class="text-sm opacity-60 mt-2">No music linked to this organization.</p>
        {% endif %}
      </div>
    </div>

    <div class="card bg-base-100 shadow-sm border border-base-200 lg:col-span-3">
      <div class="card-body">
        <h2 class="card-title">Notes</h2>
        <div class="mt-3 text-sm">
          {% if org.notes %}
            {{ org.notes|linebreaks }}
          {% else %}
            <span class="opacity-60">No notes added.</span>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</section>
{% endblock %}
